
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at Dec 30, 2013
 Rendered using Reflow Maven Skin 1.0.1-SNAPSHOT (http://andriusvelykis.github.com/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Extend the DSCilia language | iCasa</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.2.2/spacelab/bootstrap.min.css" rel="stylesheet" />
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="./css/bootswatch.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />
		
		<link href="http://yandex.st/highlightjs/7.3/styles/default.min.css" rel="stylesheet" />
		
		<link href="./css/lightbox.css" rel="stylesheet" />
		
		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />
		
		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		
<link rel="stylesheet" type="text/css" href="./css/site.css"/>
<link rel="stylesheet" type="text/css" href="./css/font-awesome.css"/>
<script type="text/javascript">var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-35847694-2']);
                _gaq.push(['_trackPageview']);

                (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();</script>
<script type="text/javascript">$(document).ready(function () {
                $("pre code").parent().addClass("prettyprint");
                prettyPrint();
                });</script>
<link rel="shortcut icon" href="favicon.png"/>
	</head>

	<body class="page-extenddsl project-cilia-parent-reactor" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="http://github.com/AdeleResearchGroup/Cilia">Cilia on github</a>
					<div class="nav-collapse">
						<ul class="nav pull-right">
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Cilia <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="index.html" title="Home">Home </a></li>
									<li><a href="overview.html" title="Overview">Overview </a></li>
									<li><a href="download.html" title="Download">Download </a></li>
									<li><a href="components.html" title="Available components">Available components </a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="quickstart.html" title="Quick start">Quick start </a></li>
									<li class="dropdown-submenu">
										<a href="extendDSL.html#" title="DSL Reference">DSL Reference </a>
										<ul class="dropdown-menu">
											<li><a href="dslComponent.html" title="Component Type specification">Component Type specification </a></li>
											<li><a href="dslCilia.html" title="Chain description">Chain description </a></li>
											<li><a href="cfgCilia.html" title="Chain configuration">Chain configuration </a></li>
										</ul>
									</li>
									<li><a href="rest-api.html" title="REST API">REST API </a></li>
									<li><a href="gogo-commands.html" title="Gogo commands">Gogo commands </a></li>
									<li><a href="apidocs/index.html" title="Javadoc">Javadoc </a></li>
								</ul>
							</li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Advanced tutorials <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="linker.html" title="Creating a new Linker">Creating a new Linker </a></li>
									<li><a href="adapter.html" title="Creating new adapter">Creating new adapter </a></li>
									<li><a href="monitor.html" title="Using monitoring capabilities">Using monitoring capabilities </a></li>
									<li class="active"><a href="" title="Extending the DSL Language">Extending the DSL Language </a></li>
									<li class="dropdown-submenu">
										<a href="extendDSL.html#" title="Runtime Manipulation">Runtime Manipulation </a>
										<ul class="dropdown-menu">
											<li><a href="builder.html" title="Cilia Admin Builder Pattern">Cilia Admin Builder Pattern </a></li>
											<li><a href="ciliaAdmin.html" title="Cilia Admin Service">Cilia Admin Service </a></li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>
		
	<div class="container">
	
	<!-- Masthead
	================================================== -->
	<header class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="extendDSL.html#" id="bannerLeft"><img src="cilia-small.png" alt='"'Cilia - A service mediation framework for dynamic applications'"' /></a>
					<p class="lead">A service mediation framework for dynamic applications</p>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
		<hr class="toc-separator" />
		<div id="toc-bar" class="navbar">
			<div class="navbar-inner">
				<div id="toc-scroll-target" class="container">
					<ul id="toc" class="nav">
						<li class="toplevel"><a href="#extend_the_dscilia_language" title="Extend the DSCilia language">Extend the DSCilia language</a></li>
						<li class="toplevel"><a href="#Description_of_the_constituent_to_configure" title="Description of the constituent to configure">Description of the constituent to configure</a></li>
						<li class="toplevel"><a href="#Project_Creation" title="Project Creation">Project Creation</a></li>
						<li class="dropdown">
							<a href="#The_CiliaExtenderParser_interface" title="The CiliaExtenderParser interface" class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#">The CiliaExtenderParser interface <b class="caret"></b></a>
							<ul class="dropdown-menu" role="menu">
								<!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
								<li><a href="#The_CiliaExtenderParser_interface" title="The CiliaExtenderParser interface">The CiliaExtenderParser interface</a></li>
								<li class="divider"></li>
								<li><a href="#Methods" title="Methods">Methods</a></li>
								<li><a href="#The_DomExtenderParser_class" title="The DomExtenderParser class">The DomExtenderParser class</a></li>

							</ul>
						</li>
						<li class="toplevel"><a href="#Creating_the_extender_parser" title="Creating the extender parser">Creating the extender parser</a></li>
					</ul>
				</div>
			</div>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<div class="page-header">
 <h1 id="extend_the_dscilia_language">Extend the DSCilia language</h1>
</div> 
<p>The DSCilia language is the one which permits to specify mediation chains using XML. To see more in detail how this language allows to build mediation chains see the section <a href="Cilia/Cilia_DSL_types_Reference_mediator/Cilia_Application_Description" title="wikilink">Application Description Language</a>.</p> 
<p>Cilia proposes a way to extends this language. Those extensions allows to customize the configuration of mediators in a better and more human readable way. So, this extensions, in resume, will and only will allow to add properties to mediators or any of its constituents <i>i.e.</i> its scheduler, its processor and/or its dispatcher.</p> 
<div class="section"> 
 <h2 id="Description_of_the_constituent_to_configure">Description of the constituent to configure</h2> 
 <p>We will create a parser for the periodic scheduler. This scheduler has two properties, <b>period</b> and <b>delay</b>. <a href="Cilia/Cilia_Components#Periodic" title="wikilink">Here</a> you can find info about this scheduler.</p> 
 <p>Using the basic language, you must configure a mediator as follow:</p> 
 <div class="source"> 
  <pre>&lt;mediator-instance id=&quot;mediatorId&quot; type=&quot;MyMediator&quot;&gt;
  &lt;scheduler&gt;
     &lt;property name=&quot;period&quot; value=&quot;5000&quot;/&gt;
     &lt;property name=&quot;delay&quot; value=&quot;30000&quot;/&gt;
  &lt;/scheduler&gt;
&lt;/mediator-instance&gt;
</pre> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Project_Creation">Project Creation</h2> 
 <p>To create a project, we follow the instructions presented on the <a href="Cilia/Getting_Started_Tutorial/Project_Creation" title="wikilink">creating project section</a>.</p> 
</div> 
<div class="section"> 
 <h2 id="The_CiliaExtenderParser_interface">The CiliaExtenderParser interface</h2> 
 <p>In order to create a new extender parser, we need to create an OSGi services which provides the <i>fr.liglab.adele.cilia.model.parser.CiliaExtenderParser</i> interface.</p> 
 <div class="source"> 
  <pre>public interface CiliaExtenderParser {
  /**
   * See if the parser could handle the component description
   * @return
   */
  public boolean canHandle(Object mediatorDescription);
  /**
   * Creates or modifies a Component based on the component description.
   * @param componentDescription
   * @return
   */
  public IComponent getComponent(Object componentDescription, IComponent currentComponent) throws   CiliaParserException; 

}
</pre> 
 </div> 
 <p>This interface is located on the <b>cilia-core</b> project.</p> 
 <div class="section"> 
  <h3 id="Methods">Methods</h3> 
  <p>There are two methods to implement.</p> 
  <ul> 
   <li><p><b>canHandle (Object componentDescription)</b>: As we have only, at the moment, one parser based on DOM, the received object should be a Node object (org.w3c.dom.Node). This method will be called by the main dscilia parser to determine if a mediator instance need to be parsed by the new extender parser. If the return of calling this method is <b>true</b>, then the <b>getComponent</b> method will be called.</p></li> 
   <li><p><b>getComponent(Object componentDescription, IComponent currentComponent)</b>: This method is called if the canHandle method return true. The <b>componentDescription</b> object, as well as in canHandle method, will be a Node object (org.w3c.dom.Node). The objective of this method is to inspect the receiving Node object in order to obtain the desired information. The current component is the actual information previously obtained by the main dscilia parser or by any other parser.</p></li> 
  </ul> 
 </div> 
 <div class="section"> 
  <h3 id="The_DomExtenderParser_class">The DomExtenderParser class</h3> 
  <p>This class could be used to facilitate the work of parsing. It has two protected fields:</p> 
  <ul> 
   <li>NAME: The name of the tag we are interested on.</li> 
   <li>NAMESPACE: The namespace for the tag.</li> 
  </ul> 
  <p>Also, it has two protected methods:</p> 
  <ul> 
   <li>Node getNode(String parent, Object mediatorNode): It will locate the Node with a parent called <i>parent</i>. Also, this node should has a localName equals to NAME and a URI Namespace equals to NAMESPACE.</li> 
  </ul> 
  <p>For example, if the XML file is:</p> 
  <div class="source"> 
   <pre>&lt;mediator-instance ...&gt;
 &lt;scheduler&gt;
    &lt;periodic period=&quot;5000&quot; delay=&quot;30000&quot; xmlns=&quot;fr.imag.adele.cilia.periodic&quot; /&gt;
 &lt;/scheduler&gt;
&lt;/mediator-instance&gt;
</pre> 
  </div> 
  <p>Setting the NAMESPACE field as <i>fr.imag.adele.cilia.periodic</i> and the NAME as <i>periodic</i>. Then, calling the <b>getNode(scheduler, mediatorNode)</b> will return the <b>periodic</b> node:</p> 
  <div class="source"> 
   <pre>  &lt;periodic period=&quot;5000&quot; delay=&quot;30000&quot; xmlns=&quot;fr.imag.adele.cilia.periodic&quot; /&gt;
</pre> 
  </div> 
  <ul> 
   <li>String getAttributeValue(Node node, String attrName): this method allow us to easily obtain the value of any attribute in a given node.</li> 
  </ul> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Creating_the_extender_parser">Creating the extender parser</h2> 
 <p>Now, we know the interface we need to implement and the class that can help us to build the service easily. So, now we will create the service. First, we create a class implementing the <i>CiliaExtenderParser</i> interface. To facilitate the work, this class will extends also the <i>DomExtenderParser</i> class.</p> 
 <div class="source"> 
  <pre>public class PeriodicParser extends DomExtenderParser implements
      CiliaExtenderParser {
  /**
  * We set the NAME and NAMESPACE to use the DomExtenderParser methods.
  */
  public PeriodicParser(){
    NAME=&quot;periodic&quot;;
    NAMESPACE=&quot;fr.liglab.adele.cilia.scheduler&quot;;
  }
  
  /**
  * We see if the mediator description has the periodic node with 
  * fr.liglab.adele.cilia.scheduler as namespace. 
  * Also, it should be a child of scheduler.
  */
  public boolean canHandle(Object mediatorDescription) {
    Node disp = getNode(&quot;scheduler&quot;,mediatorDescription);
    if(disp == null) {
      return false;
    }
    return true;
  }
  

  public IComponent getComponent(Object componentDescription,
         IComponent currentComponent) throws CiliaParserException {
    /**We obtain the node. We are sure it exist as this method is called
    * only when the canHandle returns true.
    */
    Node periodicN = getNode(&quot;scheduler&quot;,componentDescription);

    /** We obtain the configuration from the Node.*/
    String period  = getAttributeValue(periodicN, &quot;period&quot;);
    String delay  = getAttributeValue(periodicN, &quot;delay&quot;);

    /** We add the acquired information to the currentComponent as properties*/
    if (period != null) {
       Long lperiod = Long.parseLong(period);
       currentComponent.setProperty(&quot;period&quot;, lperiod);
    }
    if (delay != null) {
      ldelay = Long.parseLong(delay);
      currentComponent.setProperty(&quot;delay&quot;, ldelay);
    }
    return currentComponent;
  }

}
</pre> 
 </div> 
 <p>Now, we only need to add the service on the service registry. Using iPOJO, this could be done as follows:</p> 
 <div class="source"> 
  <pre>&lt;!--We create the component description--&gt;
&lt;component
   classname=&quot;fr.liglab.adele.cilia.compendium.extender.parsers.PeriodicParser&quot;
   immediate=&quot;true&quot;&gt;
      &lt;provides /&gt;
&lt;/component&gt;
&lt;!--And we create the instance--&gt;
&lt;instance
   component=&quot;fr.liglab.adele.cilia.compendium.extender.parsers.PeriodicParser&quot; /&gt;
</pre> 
 </div> 
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->
	
	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span9 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Cilia</li>
						<li>
							<a href="index.html" title="Home">Home </a>
						</li>
						<li>
							<a href="overview.html" title="Overview">Overview </a>
						</li>
						<li>
							<a href="download.html" title="Download">Download </a>
						</li>
						<li>
							<a href="components.html" title="Available components">Available components </a>
						</li>
						<li class="nav-header">Documentation</li>
						<li>
							<a href="quickstart.html" title="Quick start">Quick start </a>
						</li>
						<li>
							<a href="extendDSL.html#" title="DSL Reference">DSL Reference <i class="icon-chevron-down"></i></a>
							<ul class="nav nav-list">
						<li>
							<a href="dslComponent.html" title="Component Type specification">Component Type specification </a>
						</li>
						<li>
							<a href="dslCilia.html" title="Chain description">Chain description </a>
						</li>
						<li>
							<a href="cfgCilia.html" title="Chain configuration">Chain configuration </a>
						</li>
							</ul>
						</li>
						<li>
							<a href="rest-api.html" title="REST API">REST API </a>
						</li>
						<li>
							<a href="gogo-commands.html" title="Gogo commands">Gogo commands </a>
						</li>
						<li>
							<a href="apidocs/index.html" title="Javadoc">Javadoc </a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote>A service mediation framework for dynamic applications.</blockquote>
				</div>
			</div>
		</div>
	</footer>
		
	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2012-2013 <a href="http://adele.imag.fr">Adele Team | LIG</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 1.7.4-SNAPSHOT. </span><span class="publishDate">Last Published: 2013-12-30. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->

	<!-- Fallback jQuery loading from Google CDN:
	     http://stackoverflow.com/questions/1014203/best-way-to-use-googles-hosted-jquery-but-fall-back-to-my-hosted-library-on-go -->
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script type="text/javascript">
		if (typeof jQuery == 'undefined')
		{
			document.write(unescape("%3Cscript src='./js/jquery-1.8.3.min.js' type='text/javascript'%3E%3C/script%3E"));
		}
	</script>
	
	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.js"></script>
	<script src="./js/jquery.smooth-scroll.min.js"></script>
	<!-- back button support for smooth scroll -->
	<script src="./js/jquery.ba-bbq.min.js"></script>
	<script src="http://yandex.st/highlightjs/7.3/highlight.min.js"></script>

	<script src="./js/reflow-skin.js"></script>
	
	</body>
</html>
