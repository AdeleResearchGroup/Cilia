
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at Dec 31, 2013
 Rendered using Reflow Maven Skin 1.0.1-SNAPSHOT (http://andriusvelykis.github.com/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Creating a new project | iCasa</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.2.2/spacelab/bootstrap.min.css" rel="stylesheet" />
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="./css/bootswatch.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />
		
		<link href="http://yandex.st/highlightjs/7.3/styles/default.min.css" rel="stylesheet" />
		
		<link href="./css/lightbox.css" rel="stylesheet" />
		
		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />
		
		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		
<link rel="stylesheet" type="text/css" href="./css/site.css"/>
<link rel="stylesheet" type="text/css" href="./css/font-awesome.css"/>
<script type="text/javascript">var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-35847694-2']);
                _gaq.push(['_trackPageview']);

                (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();</script>
<script type="text/javascript">$(document).ready(function () {
                $("pre code").parent().addClass("prettyprint");
                prettyPrint();
                });</script>
<link rel="shortcut icon" href="favicon.png"/>
	</head>

	<body class="page-quickstart project-cilia-parent-reactor" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="http://github.com/AdeleResearchGroup/Cilia">Cilia on github</a>
					<div class="nav-collapse">
						<ul class="nav pull-right">
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Cilia <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="index.html" title="Home">Home </a></li>
									<li><a href="overview.html" title="Overview">Overview </a></li>
									<li><a href="download.html" title="Download">Download </a></li>
									<li><a href="components.html" title="Available components">Available components </a></li>
								</ul>
							</li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li class="active"><a href="" title="Quick start">Quick start </a></li>
									<li class="dropdown-submenu">
										<a href="quickstart.html#" title="DSL Reference">DSL Reference </a>
										<ul class="dropdown-menu">
											<li><a href="dslComponent.html" title="Component Type specification">Component Type specification </a></li>
											<li><a href="dslCilia.html" title="Chain description">Chain description </a></li>
											<li><a href="cfgCilia.html" title="Chain configuration">Chain configuration </a></li>
										</ul>
									</li>
									<li><a href="rest-api.html" title="REST API">REST API </a></li>
									<li><a href="gogo-commands.html" title="Gogo commands">Gogo commands </a></li>
									<li><a href="apidocs/index.html" title="Javadoc">Javadoc </a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Advanced tutorials <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="linker.html" title="Creating a new Linker">Creating a new Linker </a></li>
									<li><a href="adapter.html" title="Creating new adapter">Creating new adapter </a></li>
									<li><a href="monitor.html" title="Using monitoring capabilities">Using monitoring capabilities </a></li>
									<li><a href="extendDSL.html" title="Extending the DSL Language">Extending the DSL Language </a></li>
									<li class="dropdown-submenu">
										<a href="quickstart.html#" title="Runtime Manipulation">Runtime Manipulation </a>
										<ul class="dropdown-menu">
											<li><a href="builder.html" title="Cilia Admin Builder Pattern">Cilia Admin Builder Pattern </a></li>
											<li><a href="ciliaAdmin.html" title="Cilia Admin Service">Cilia Admin Service </a></li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>
		
	<div class="container">
	
	<!-- Masthead
	================================================== -->
	<header class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="quickstart.html#" id="bannerLeft"><img src="cilia-small.png" alt='"'Cilia - A service mediation framework for dynamic applications'"' /></a>
					<p class="lead">A service mediation framework for dynamic applications</p>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
		<hr class="toc-separator" />
		<div id="toc-bar" class="navbar">
			<div class="navbar-inner">
				<div id="toc-scroll-target" class="container">
					<ul id="toc" class="nav">
						<li class="dropdown">
							<a href="#Creating_a_new_project" title="Creating a new project" class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#">Creating a new project <b class="caret"></b></a>
							<ul class="dropdown-menu" role="menu">
								<!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
								<li><a href="#Creating_a_new_project" title="Creating a new project">Creating a new project</a></li>
								<li class="divider"></li>
								<li><a href="#Project_Structure" title="Project Structure">Project Structure</a></li>
								<li><a href="#Sample_Maven_Script_File" title="Sample Maven Script File">Sample Maven Script File</a></li>
								<li><a href="#Project_Build" title="Project Build">Project Build</a></li>

							</ul>
						</li>
						<li class="divider-vertical"></li>
						<li class="dropdown">
							<a href="#Hello_World_Sample" title="Hello World Sample" class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#">Hello World Sample <b class="caret"></b></a>
							<ul class="dropdown-menu" role="menu">
								<!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
								<li><a href="#Hello_World_Sample" title="Hello World Sample">Hello World Sample</a></li>
								<li class="divider"></li>
								<li><a href="#Overview" title="Overview">Overview</a></li>
								<li class="dropdown-submenu">
									<a href="#Mediator_Implementation" title="Mediator Implementation">Mediator Implementation</a>
									<ul class="dropdown-menu" role="menu">
								<li><a href="#Processor" title="Processor">Processor</a></li>
								<li><a href="#Scheduler_and_Dispatcher" title="Scheduler and Dispatcher">Scheduler and Dispatcher</a></li>
								<li><a href="#Mediator_Description" title="Mediator Description">Mediator Description</a></li>
								<li><a href="#Build_Compilation_and_Packaging" title="Build (Compilation and Packaging)">Build (Compilation and Packaging)</a></li>
								<li><a href="#Mediator_Deployment" title="Mediator Deployment">Mediator Deployment</a></li>

									</ul>
								</li>
								<li class="dropdown-submenu">
									<a href="#Hello_World_Chain" title="Hello World Chain">Hello World Chain</a>
									<ul class="dropdown-menu" role="menu">
								<li><a href="#Chain_Description" title="Chain Description">Chain Description</a></li>
								<li><a href="#Chain_Deployment" title="Chain Deployment">Chain Deployment</a></li>

									</ul>
								</li>

							</ul>
						</li>
						<li class="divider-vertical"></li>
						<li class="dropdown">
							<a href="#Developing_Mediators" title="Developing Mediators" class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#">Developing Mediators <b class="caret"></b></a>
							<ul class="dropdown-menu" role="menu">
								<!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
								<li><a href="#Developing_Mediators" title="Developing Mediators">Developing Mediators</a></li>
								<li class="divider"></li>
								<li class="dropdown-submenu">
									<a href="#Adding_a_new_Mediator_Encryptor" title="Adding a new Mediator (Encryptor)">Adding a new Mediator (Encryptor)</a>
									<ul class="dropdown-menu" role="menu">
								<li class="dropdown-submenu">
									<a href="#Encryptor_Mediator_Implementation" title="Encryptor Mediator Implementation">Encryptor Mediator Implementation</a>
									<ul class="dropdown-menu" role="menu">
								<li><a href="#Processor_Definition" title="Processor Definition">Processor Definition</a></li>
								<li><a href="#Mediator_Description" title="Mediator Description">Mediator Description</a></li>

									</ul>
								</li>
								<li><a href="#Chain_Description" title="Chain Description">Chain Description</a></li>
								<li><a href="#Hello-Encryption_Chain_Execution" title="Hello-Encryption Chain Execution">Hello-Encryption Chain Execution</a></li>

									</ul>
								</li>

							</ul>
						</li>
						<li class="divider-vertical"></li>
						<li class="dropdown">
							<a href="#Developing_a_Scheduler_and_a_Dispatcher" title="Developing a Scheduler and a Dispatcher" class="dropdown-toggle" role="button" data-toggle="dropdown" data-target="#">Developing a Scheduler and a Dispatcher <b class="caret"></b></a>
							<ul class="dropdown-menu" role="menu">
								<!-- Repeat the item, otherwise it is not clickable as the dropdown root -->
								<li><a href="#Developing_a_Scheduler_and_a_Dispatcher" title="Developing a Scheduler and a Dispatcher">Developing a Scheduler and a Dispatcher</a></li>
								<li class="divider"></li>
								<li><a href="#Chain_Description" title="Chain Description">Chain Description</a></li>
								<li><a href="#Implementating_a_Cilia_Scheduler" title="Implementating a Cilia Scheduler">Implementating a Cilia Scheduler</a></li>
								<li><a href="#Implementating_a_Cilia_Dispatcher" title="Implementating a Cilia Dispatcher">Implementating a Cilia Dispatcher</a></li>
								<li class="dropdown-submenu">
									<a href="#Mediator_Implementation" title="Mediator Implementation">Mediator Implementation</a>
									<ul class="dropdown-menu" role="menu">
								<li><a href="#Processor_Implementation" title="Processor Implementation">Processor Implementation</a></li>
								<li><a href="#Mediator_Description" title="Mediator Description">Mediator Description</a></li>

									</ul>
								</li>
								<li><a href="#Chain_Description" title="Chain Description">Chain Description</a></li>

							</ul>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<div class="section"> 
 <div class="page-header">
  <h2 id="Creating_a_new_project">Creating a new project</h2>
 </div> 
 <p>For building Cilia projects we use the <a class="externalLink" href="http://maven.apache.org">Apache Maven</a> project management software. Maven compiles the Java code, adds the appropriated metadata to the components and creates OSGi standard bundles (jar files). To have an idea about Maven you can follow the <a class="externalLink" href="http://maven.apache.org/guides/getting-started/maven-in-five-minutes.html">Maven in 5 minutes</a> tutorial.</p> 
 <div class="section"> 
  <h3 id="Project_Structure">Project Structure</h3> 
  <p>A Cilia project should follow this structure :</p> 
  <div class="source"> 
   <pre>**src/java**: java sources files of the project.
**src/resources/metadata.xml** : Cilia descriptor file.
**pom.xml** : maven script file.
</pre> 
  </div> 
  <p>A sample project structures is shown in next image:</p> 
  <p><img src="maven-structure.png" alt="maven-structure" /></p> 
 </div> 
 <div class="section"> 
  <h3 id="Sample_Maven_Script_File">Sample Maven Script File</h3> 
  <p>This file is used to describe the project, information to be used is:</p> 
  <ul> 
   <li>identification : project name, version, type of packaging, etc.</li> 
   <li>repository : repository of artifacts to be used in compilation task.</li> 
   <li>dependencies : project dependencies, in Cilia project dependencies in Cilia Core and Cilia runtime are used suddenly.</li> 
   <li>build: the target platform of Cilia is OSGi, then the build process includes the maven-bundle-plugin and the maven-ipojo-plugin like they are used in this sample pom file.</li> 
  </ul> 
  <div class="source"> 
   <pre>&lt;project&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;!-- Project Identification --&gt;
  &lt;groupId&gt;fr.liglab.adele.cilia&lt;/groupId&gt;
  &lt;artifactId&gt;hello-mediator&lt;/artifactId&gt;
  &lt;version&gt;1.0.0-SNAPSHOT&lt;/version&gt;
  &lt;packaging&gt;bundle&lt;/packaging&gt;
  &lt;name&gt;Hello Mediator&lt;/name&gt;

  &lt;!-- Repositories List --&gt;
  &lt;repositories&gt;
    &lt;repository&gt;
      &lt;id&gt;maven-cilia-repository-release&lt;/id&gt;
      &lt;name&gt;Cilia - Release&lt;/name&gt;
      &lt;url&gt;http://repository-cilia.forge.cloudbees.com/release/&lt;/url&gt;
      &lt;layout&gt;default&lt;/layout&gt;
    &lt;/repository&gt;
    &lt;repository&gt;
      &lt;id&gt;maven-cilia-repository-snapshot&lt;/id&gt;
      &lt;name&gt;Cilia - Snapshot&lt;/name&gt;
      &lt;url&gt;http://repository-cilia.forge.cloudbees.com/snapshot/&lt;/url&gt;
      &lt;layout&gt;default&lt;/layout&gt;
    &lt;/repository&gt;
  &lt;/repositories&gt;

  &lt;!-- Dependencies Description--&gt;
  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;fr.liglab.adele.cilia&lt;/groupId&gt;
      &lt;artifactId&gt;cilia-core&lt;/artifactId&gt;
      &lt;version&gt;1.7.4&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;fr.liglab.adele.cilia&lt;/groupId&gt;
      &lt;artifactId&gt;cilia-runtime&lt;/artifactId&gt;
      &lt;version&gt;1.7.4&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

  &lt;!-- Build Description--&gt;
  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
        &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.4.3&lt;/version&gt;
        &lt;extensions&gt;true&lt;/extensions&gt;
        &lt;configuration&gt;
          &lt;instructions&gt;
            &lt;Bundle-SymbolicName&gt;${pom.artifactId}&lt;/Bundle-SymbolicName&gt;
            &lt;Private-Package&gt;fr.liglab.adele.cilia.components.mediators,fr.liglab.adele.cilia.components.mediators.monitor&lt;/Private-Package&gt;
          &lt;/instructions&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;
        &lt;artifactId&gt;maven-ipojo-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.6.0&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;ipojo-bundle&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Project_Build">Project Build</h3> 
  <p>To build a Cilia project with maven use this command in a OS console:</p> 
  <div class="source"> 
   <pre>mvn clean install
</pre> 
  </div> 
  <p>You can also use a pluging for your IDE as <a class="externalLink" href="http://eclipse.org/m2e/">M2Eclipse</a>.</p> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Hello_World_Sample">Hello World Sample</h2> 
 <p>In this lesson, you will manipulate Cilia mediation chains. We will extend the Hello Mediator example to add other mediators to the chain. In addition, we will study other capabilities of mediators and bindings.</p> 
 <div class="section"> 
  <h3 id="Overview">Overview</h3> 
  <p>The goal of this section it to create a simple mediation chain with only one mediator i.e. the “Hello World” mediator. The mediator receives an input string from a GUI and displays and “Hello, …” message into the standard output console.</p> 
  <p><img src="hello-chain.png" alt=" center | 600px" /></p> 
 </div> 
 <div class="section"> 
  <h3 id="Mediator_Implementation">Mediator Implementation</h3> 
  <p>A mediator is composed of three elements: processor, scheduler and dispatcher (for an detailed explanation see the <a href="overview.html"> Cilia Overview</a>). In this subsection, for the Hello World mediator we will present its elements, then the mediator description and finally the mediation build process. </p> 
  <div class="section"> 
   <h4 id="Processor">Processor</h4> 
   <p>The processor of the Hello Mediator takes the data received by the mediator, next it extracts the content of this data (a string in this case), then it adds the text “hello, ” to this string, and finally it sends the data to the next mediator. The Java class implementation corresponding to this processor is as follows:</p> 
   <div class="source"> 
    <pre>package fr.liglab.adele.cilia.components.mediators;

import fr.liglab.adele.cilia.Data;

/**
 * The Hello World Processor Class
 * 
 */
public class HelloProcessor {

   /**
    * Method modifying the received data
    * 
    * @param data The processor received data
    * @return The data with &quot;Hello, &quot; prefix
    */
   public Data sayHello(Data data) {
      if (data != null) {
         data.setContent(&quot;Hello, &quot; + data.getContent().toString());
      }
      return data;
   }
}
</pre> 
   </div> 
   <p>Each element in Cilia must be described using the Cilia DSL language. In this description is provided information about the class implementing the processor, the method used to treat the data, and the data type used to transport information (by default is fr.liglab.adele.cilia.Data).</p> 
   <p>This description is realized as follows:</p> 
   <div class="source"> 
    <pre>&lt;processor name=&quot;HelloProcessor&quot; classname=&quot;fr.liglab.adele.cilia.components.mediators.HelloProcessor&quot;&gt;
  &lt;cilia:method name=&quot;sayHello&quot; data.type=&quot;fr.liglab.adele.cilia.Data&quot; /&gt;
&lt;/processor&gt;
</pre> 
   </div> 
  </div> 
  <div class="section"> 
   <h4 id="Scheduler_and_Dispatcher">Scheduler and Dispatcher</h4> 
   <p>A set of prebuilt Schedulers and Dispatchers are available into the Cilia compendium distribution. For this mediator we will use the Immediate Scheduler (the data is passed to the processor when they are received by the scheduler) and the Multicast Dispatcher (the data is passed to the all next mediators).</p> 
  </div> 
  <div class="section"> 
   <h4 id="Mediator_Description">Mediator Description</h4> 
   <p>The mediator is described into the Cilia DSL language. The description indicates each element forming the mediator (scheduler, processor and dispatcher). The description file is a follows:</p> 
   <div class="source"> 
    <pre>&lt;mediator-component name=&quot;HelloMediator&quot; category=&quot;samples&quot;&gt;
  &lt;cilia:processor name=&quot;HelloProcessor&quot; /&gt;
  &lt;cilia:scheduler name=&quot;immediate-scheduler&quot; /&gt;
  &lt;cilia:dispatcher name=&quot;multicast-dispatcher&quot; /&gt;
   &lt;ports&gt;
      &lt;in-port name=&quot;unique&quot; type=&quot;*&quot; /&gt;
      &lt;out-port name=&quot;unique&quot; type=&quot;*&quot; /&gt;
   &lt;/ports&gt;
&lt;/mediator-component&gt;
</pre> 
   </div> 
  </div> 
  <div class="section"> 
   <h4 id="Build_Compilation_and_Packaging">Build (Compilation and Packaging)</h4> 
   <p>For build process we use Maven as presented in previously. To launch the build of this project the command “mvn clean install” must be executed in an OS console.</p> 
   <p>If the build process ends successfully the bundle hello-mediator-1.0.0-SNAPSHOT.jar must be in the target directory of the project.</p> 
  </div> 
  <div class="section"> 
   <h4 id="Mediator_Deployment">Mediator Deployment</h4> 
   <p>Mediator deployment is simple, it consists only in copying the file produced by maven (hello-mediator-1.0.0-SNAPSHOT.jar) into the <b>applications</b> directory of the installed platform. Indeed, mediator bundles are compliant OSGi bundle, it can be installed using provided capabilities by the installed platform. In our case, we have installed a Felix platform with the FileInstall extension, it allows the automatic deployment of bundles only putting files into a specific directory (e.g. the <b>applications</b> directory).</p> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Hello_World_Chain">Hello World Chain</h3> 
  <div class="section"> 
   <h4 id="Chain_Description">Chain Description</h4> 
   <p>Once the mediators created a chain can be created using instances of these mediators. We will create a chain having only one instance of the Hello World mediator presented above.</p> 
   <p>A Cilia chain descriptor has three sections: <b>adapters</b>, <b>mediators</b> and <b>bindings</b>. Adapters section defines the entry and exit points of a mediation chain, these points are represented by adapters instances. In our Hello World example, we have utilized two existing adapters; the gui-adapter allowing take data from a GUI and the console-adapter allowing send data to the standard output (cilia console). In mediators section we define and configure the instance of our HelloWord mediator. Finally in bindings sections, the entryAdapter is bound to hello mediator (data taken by the GUI Adapter is sent to the mediator) and the hello mediator is bound to the console adapter (data produced by the hello mediator is sent to the console).</p> 
   <p>The Hello World chain is described as follows:</p> 
   <div class="source"> 
    <pre>&lt;cilia&gt;
  &lt;chain id=&quot;HelloWorldChain&quot;&gt;

    &lt;!-- Adapters instances definition --&gt;
    &lt;adapters&gt;
      &lt;adapter-instance type=&quot;gui-adapter&quot; id=&quot;entryAdapter&quot; /&gt;
      &lt;adapter-instance type=&quot;console-adapter&quot; id=&quot;exitAdapter&quot; /&gt;
    &lt;/adapters&gt;

    &lt;!-- Mediators instances definition --&gt;
    &lt;mediators&gt;
      &lt;mediator-instance type=&quot;HelloMediator&quot; id=&quot;hello&quot; /&gt;
    &lt;/mediators&gt;

    &lt;!-- Bindings definition --&gt;
    &lt;bindings&gt;
      &lt;binding from=&quot;entryAdapter:unique&quot; to=&quot;hello:unique&quot; /&gt;
      &lt;binding from=&quot;hello:unique&quot; to=&quot;exitAdapter:unique&quot; /&gt;
    &lt;/bindings&gt;

  &lt;/chain&gt;
&lt;/cilia&gt;
</pre> 
   </div> 
   <p>In a chain description a unique id attributed must be defined to identify the chain, in our sample the chain id is <i>HelloWorldChain</i>. In mediators section an instance of the mediator <i>HelloMediator</i> has been described, the <i>id</i> attribute for each instance must be specified, our instance is called <i>hello</i>. The instances ports must be also be defined, the <i>hello</i> instance has a input port <i>in</i> and an ouput port <i>out</i>.</p> 
   <p>A graphical representation of the Hello World chain is shown in the next figure:</p> 
   <p><img src="hello-chain.png" alt=" center | 600px" /></p> 
  </div> 
  <div class="section"> 
   <h4 id="Chain_Deployment">Chain Deployment</h4> 
   <p>The deployment of the chain is similar to a mediator deployment. In this case, the file describing the chain (a XML document having as extension dscilia) is placed into the <b>applications</b> directory of the platform. The Cilia runtime takes in account this kind of files, it processes the file creating the instance indicated into the file and finally the defined bindings. As result, the user have a GUI window used to enter text, and when it push the Send Data button the information is sent to the hello mediator that process them and next deliver the data to the standard console, that shows the greeting message.</p> 
  </div> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Developing_Mediators">Developing Mediators</h2> 
 <p>In this lesson, you will manipulate Cilia mediation chains. We will extend the Hello Mediator example to add other mediators to the chain. In addition, we will study other capabilities of mediators and bindings.</p> 
 <div class="section"> 
  <h3 id="Adding_a_new_Mediator_Encryptor">Adding a new Mediator (Encryptor)</h3> 
  <p>This example will add a new mediator to our Hello World example. This new Mediator takes the data produced by the Hello Mediator instance and encrypts them. The data produced by the Encryptor mediator is sent to the standard output (console) in the same way that the Hello World Chain did.</p> 
  <p>To do that, we have to modify the mediation chain as follow:</p> 
  <p><img src="hello-chain-2.png" alt="hello-chain2" /></p> 
  <div class="section"> 
   <h4 id="Encryptor_Mediator_Implementation">Encryptor Mediator Implementation</h4> 
   <div class="section"> 
    <h5 id="Processor_Definition">Processor Definition</h5> 
    <p>The Encryptor class implements the processor of the Mediator. It takes the data content and then applies a DES encryption.</p> 
    <div class="source"> 
     <pre>package fr.liglab.adele.cilia.components.mediators;

import fr.liglab.adele.cilia.Data;

/**
 * Data Encryption with DES
 * 
 */
public class Encryptor {

   /**
    * Encrypts data content
    * @param data
    * @return
    */
   public Data process(Data data) {
      if (data != null) {
         String strToEncrypt = (String)data.getContent();
         byte[] temp = SimpleChiper.getInstance().encrypt(strToEncrypt);
         data.setContent(temp);
      }
      return data;
   }
}
</pre> 
    </div> 
    <p>The processor description is as follows:</p> 
    <div class="source"> 
     <pre>&lt;processor name=&quot;EncryptorProcessor&quot; classname=&quot;fr.liglab.adele.cilia.components.mediators.Encryptor&quot;&gt;
    &lt;cilia:method name=&quot;process&quot; data.type=&quot;fr.liglab.adele.cilia.Data&quot; /&gt;
&lt;/processor&gt;
</pre> 
    </div> 
   </div> 
   <div class="section"> 
    <h5 id="Mediator_Description">Mediator Description</h5> 
    <p>In this mediator we use also the immmediate scheduler and the multicast dispatcher.</p> 
    <div class="source"> 
     <pre>&lt;mediator-component name=&quot;EncryptorMediator&quot; category=&quot;samples&quot;&gt;
  &lt;cilia:processor name=&quot;EncryptorProcessor&quot; /&gt;
  &lt;cilia:scheduler name=&quot;immediate-scheduler&quot; /&gt;
  &lt;cilia:dispatcher name=&quot;multicast-dispatcher&quot; /&gt;
   &lt;ports&gt;
      &lt;in-port name=&quot;unique&quot; type=&quot;*&quot; /&gt;
      &lt;out-port name=&quot;unique&quot; type=&quot;*&quot; /&gt;
   &lt;/ports&gt;
&lt;/mediator-component&gt;
</pre> 
    </div> 
   </div> 
  </div> 
  <div class="section"> 
   <h4 id="Chain_Description">Chain Description</h4> 
   <div class="source"> 
    <pre>&lt;cilia&gt;

  &lt;chain id=&quot;HelloWorldChain-Enc&quot;&gt;

    &lt;!-- Adapters instances definition --&gt;
    &lt;adapters&gt;
        &lt;adapter-instance type=&quot;gui-adapter&quot; id=&quot;entryAdapter&quot; /&gt;
        &lt;adapter-instance type=&quot;console-adapter&quot; id=&quot;exitAdapter&quot;&gt;
          &lt;property name=&quot;console.header&quot; value=&quot;ENCRYPTOR.OUT:&quot; /&gt;
        &lt;/adapter-instance&gt;
    &lt;/adapters&gt;

    &lt;!-- Mediators instances definition --&gt;
    &lt;mediators&gt;
      &lt;mediator-instance type=&quot;HelloMediator&quot; id=&quot;hello&quot;/&gt;


      &lt;mediator-instance type=&quot;EncryptorMediator&quot; id=&quot;encryptor&quot;/&gt;

    &lt;/mediators&gt;

    &lt;!-- Bindings definition --&gt;
    &lt;bindings&gt;
      &lt;binding from=&quot;entryAdapter:unique&quot; to=&quot;hello:unique&quot; /&gt;
      &lt;binding from=&quot;hello:unique&quot; to=&quot;encryptor:unique&quot; /&gt;
      &lt;binding from=&quot;encryptor:unique&quot; to=&quot;exitAdapter:unique&quot; /&gt;
    &lt;/bindings&gt;

  &lt;/chain&gt;
&lt;/cilia&gt;
</pre> 
   </div> 
   <p>In the new architecture, an instance (e.g. <tt>encryptor</tt>) of the Encrypto Mediator is created. We use direct binding to connect the <tt>hello</tt> and <tt>encryptor</tt> mediators instances. Finally, we have defined the binding sending to the console (using the exitAdapter) from the <tt>encryptor</tt>. In this new architecture, the <tt>exitAdapter</tt> adapter instance has been configured to print out a header message before the print out the data.</p> 
   <p>A graphical representation of the chain is shown in the next figure:</p> 
   <p><img src="hello-chain-2.png" alt="hello-chain2" /></p> 
  </div> 
  <div class="section"> 
   <h4 id="Hello-Encryption_Chain_Execution">Hello-Encryption Chain Execution</h4> 
   <p>A window is presented, type an arbitrary text, into the console an incomprehensible message is shown.</p> 
   <p><img src="tp2-execution-encryptor.png" alt="tp2-execution-encriptor" /></p> 
  </div> 
 </div> 
</div> 
<div class="section"> 
 <h2 id="Developing_a_Scheduler_and_a_Dispatcher">Developing a Scheduler and a Dispatcher</h2> 
 <p>In a previous lesson we have learned how to use different kind of schedulers to modify the behavior of mediators. In this lesson we will learn how to create new kinds of schedulers and dispatchers to obtain a special behavior when it does not exist in the Cilia available components.</p> 
 <div class="section"> 
  <h3 id="Chain_Description">Chain Description</h3> 
  <p>This chain has a mediator instance that waits for two numbers, when they arrive the processor makes an addition of the two numbers. Then, a routing decision is made based in the result of the addition, if the number is odd the data is dispatched using a “odd” port otherwise it is dispatched by an “even” port. With this example we will show how the scheduler and the dispatcher can change the behavior of a mediator. The synchronization task of the scheduler of the NumberAddition consists in wait for a data in each one of mediator’s ports. In addition, the Dispatcher based in content of the message (odd or even) must decide where send the data.</p> 
  <p><img src="tp4-chain.png" alt="tp4-chain" /></p> 
  <p>We will focus on the NumberAddition mediator since the other mediator type NumberConverter mediator was presented in the previous trail.</p> 
 </div> 
 <div class="section"> 
  <h3 id="Implementating_a_Cilia_Scheduler">Implementating a Cilia Scheduler</h3> 
  <p>In Cilia, a Scheduler implementation class should extend the CiliaScheduler class (provided by the framework). The method notifyData will be invoked by the Cilia framework each time that a Data arrives to a mediator’s port. In this method must be implemented the data synchronization logic. In addition, the scheduler implementation has the responsibility of decide when invoked the method process to indicate to Cilia framework that Data is ready to be processed.</p> 
  <p>In this example we will implement a Scheduler that waits for a Data in each mediator port, and then triggers the data processing. The class implementing the Scheduler is the WaitAllScheduler class, the code source is as follow:</p> 
  <div class="source"> 
   <pre>/**
 * This class implements an scheduler that waits for a data in each one of mediator's ports.
 * 
 */
public class WaitAllScheduler extends AbstractScheduler {

   private Map&lt;String, Data&gt; dataMap = new HashMap&lt;String, Data&gt;();

   @Override
   public void notifyData(Data data) {

      // Determines the source port of the arriving data
      String currentPort = data.getSource();

      dataMap.put(currentPort, data);

      boolean dataInAllOthersPorts = true;
      for (String portName : dataMap.keySet()) {
         if (!portName.equals(currentPort)) {
            Data portData = dataMap.get(portName);
            dataInAllOthersPorts = dataInAllOthersPorts &amp;&amp; (portData != null);
         }
      }

      // If there is a data in each port of the mediator the process method is invoked.
      if (dataInAllOthersPorts) {
         List&lt;Data&gt; dataToProcess = null;
         dataToProcess = new ArrayList&lt;Data&gt;(dataMap.values());
         initDataMap();
         process(dataToProcess); // Data processing triggering
      }
   }
}
</pre> 
  </div> 
  <p>The description of the Scheduler is similar to the description of a processor, the name of the scheduler must be indicated and also the class implementing it, the namespace is an optional attribute.</p> 
  <div class="source"> 
   <pre>&lt;scheduler name=&quot;wait-all-scheduler&quot; classname=&quot;cilia.examples.scheduler.WaitAllScheduler&quot;       namespace=&quot;fr.liglab.adele.cilia&quot;&gt;
&lt;/scheduler&gt;
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Implementating_a_Cilia_Dispatcher">Implementating a Cilia Dispatcher</h3> 
  <p>In this example we will implement a Dispatcher that observes the data content, if it’s a odd number it send the data by the “odd” port otherwise it send the data by the “even” port. The class implementing the Dispatcher is the NumberDispatcher class, the code source is as follow:</p> 
  <div class="source"> 
   <pre>/**
 * Dispatcher implementation based in the data content (odd or even numbers) 
 */
public class NumberDispatcher extends AbstractDispatcher {

   /**
    * Name of port used to send the odd number
    */
   private String oddPort;

   /**
    * Name of port used to send the even number
    */
   private String evenPort;

   @Override
   public void dispatch(Data data) throws CiliaException {
        String content = (String) data.getContent();
        long number = Long.parseLong(content);
        if (number % 2 == 0) {
            send(oddPort, data); //Sending data using the odd port
        } else {
            send(evenPort, data); // Sending data using the even port 
        }
   }
}
</pre> 
  </div> 
  <p>The description of the Dispatcher is similar to the description of a processor, the name of the scheduler must be indicated and also the class implementing it, the namespace is an optional attribute. </p> 
  <p>The ports used to send the numbers in the dispatcher must be indicated to the implementation class. Consequently, two properties have been defined: <b>oddPort</b> and <b>evenPort</b>, these properties will be set when the mediation chain is defined, their default values are <b>odd</b> and <b>even</b> respectively.</p> 
  <div class="source"> 
   <pre>&lt;dispatcher name=&quot;odd-even-dispatcher&quot; classname=&quot;cilia.examples.dispatcher.NumberDispatcher&quot;       namespace=&quot;fr.liglab.adele.cilia&quot;&gt;
  &lt;properties&gt;
     &lt;property name=&quot;oddPort&quot; field=&quot;oddPort&quot; value=&quot;odd&quot; /&gt;
     &lt;property name=&quot;evenPort&quot; field=&quot;evenPort&quot; value=&quot;even&quot; /&gt;
  &lt;/properties&gt;
&lt;/dispatcher&gt;
</pre> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Mediator_Implementation">Mediator Implementation</h3> 
  <div class="section"> 
   <h4 id="Processor_Implementation">Processor Implementation</h4> 
   <p>This processor takes a List of Data (each data contains a <b>long</b> number) and calculates the addition of the elements of the list. The source code is a follow:</p> 
   <div class="source"> 
    <pre>/**
 * This processor takes two numbers (long) as parameter and returns the addition of them.
 */
public class NumberAddition {

   /**
    * The process method
    * @param list List containing two numbers.
    * @return a list containing a Data with the result
    */
   public List&lt;Data&gt; process (List&lt;Data&gt; list) {
      long result = 0;
      for (Data data : list) {
         String content = (String)data.getContent();
         Long number = null;
         try {
             number = Long.decode(content);
         } catch (Exception ex) {
             number = Long.valueOf(-1);
         }
         if (number.longValue() &lt; 0) {
            return null;
        }
         result += number;
      }
      // List creation
      List&lt;Data&gt; newList = new ArrayList&lt;Data&gt;();
      newList.add(new Data(Long.toString(result)));
      return newList;
  }

}
</pre> 
   </div> 
   <p>The processor description indicates that it takes a java.util.List as parameter.</p> 
   <div class="source"> 
    <pre>&lt;processor name=&quot;NumberAdditionProcessor&quot; classname=&quot;cilia.examples.mediator.filter.NumberAddition&quot;&gt;
  &lt;cilia:method name=&quot;process&quot; data.type=&quot;java.util.List&quot; /&gt;
&lt;/processor&gt;
</pre> 
   </div> 
  </div> 
  <div class="section"> 
   <h4 id="Mediator_Description">Mediator Description</h4> 
   <p>The mediator is created using the three elements presented above. The mediator will have a <b>wait-all-scheduler</b> Scheduler and an <b>odd-even-dispatcher</b> Dispatcher. Finally, its processor is the <b>NumberAdditionProcessor</b>. The description is as follow:</p> 
   <div class="source"> 
    <pre>&lt;mediator-component name=&quot;NumberAdditionMediator&quot; category=&quot;samples&quot;&gt;
  &lt;cilia:processor name=&quot;NumberAdditionProcessor&quot; /&gt;
  &lt;cilia:scheduler name=&quot;wait-all-scheduler&quot; /&gt;
  &lt;cilia:dispatcher name=&quot;odd-even-dispatcher&quot; /&gt;
&lt;/mediator-component&gt;
</pre> 
   </div> 
  </div> 
 </div> 
 <div class="section"> 
  <h3 id="Chain_Description">Chain Description</h3> 
  <p>This chain receives the data from the GUI window (using the gui-console binding). Each window is connected to an input port (i1 and i2) of the NumberAddition mediator instance (m-add). Next, the m-add instance is connected to two instances of the NumberConverterMediator i.e. m-nce and m-ncf using its exit ports odd and event respectively. The odd port is bound to the m-nce instance that gets the text representation of a number in English. The even port is bound to the m-ncf instance that gets the text representation of a number in English.</p> 
  <p><img src="tp4-chain.png" alt="tp4-chain" /></p> 
  <p>The description of the chain is as follow:</p> 
  <div class="source"> 
   <pre>&lt;cilia&gt;
  &lt;chain id=&quot;ConverterChain&quot; &gt;

    &lt;!-- Adapters instances definition --&gt;
    &lt;adapters&gt;
      &lt;adapter-instance type=&quot;gui-adapter&quot; id=&quot;entryAdapter-1&quot; /&gt;
            &lt;adapter-instance type=&quot;gui-adapter&quot; id=&quot;entryAdapter-2&quot; /&gt;
      &lt;adapter-instance type=&quot;console-adapter&quot; id=&quot;exitAdapter&quot; /&gt;
    &lt;/adapters&gt;

    &lt;!-- Mediators instances definition --&gt;
    &lt;mediators&gt;
      &lt;mediator-instance type=&quot;NumberAdditionMediator&quot; id=&quot;numberAddition&quot;&gt;
        &lt;ports&gt;
          &lt;in-port name=&quot;in1&quot; /&gt;
          &lt;in-port name=&quot;in2&quot; /&gt;
          &lt;out-port name=&quot;odd&quot; /&gt;
          &lt;out-port name=&quot;even&quot; /&gt;
        &lt;/ports&gt;
        &lt;property name=&quot;oddPort&quot; value=&quot;odd&quot; /&gt;
        &lt;property name=&quot;evenPort&quot; field=&quot;even&quot; /&gt;
      &lt;/mediator-instance&gt;
      &lt;mediator-instance type=&quot;NumberConverterMediator&quot; id=&quot;fr-numberConverter&quot;&gt;
        &lt;ports&gt;
          &lt;in-port name=&quot;in&quot; /&gt;
          &lt;out-port name=&quot;out&quot; /&gt;
        &lt;/ports&gt;
        &lt;property name=&quot;requires.filters&quot;&gt;
          &lt;property name=&quot;language&quot; value=&quot;(language=french)&quot; /&gt;
        &lt;/property&gt;
      &lt;/mediator-instance&gt;
      &lt;mediator-instance type=&quot;NumberConverterMediator&quot; id=&quot;en-numberConverter&quot;&gt;
        &lt;ports&gt;
          &lt;in-port name=&quot;in&quot; /&gt;
          &lt;out-port name=&quot;out&quot; /&gt;
        &lt;/ports&gt;
        &lt;property name=&quot;requires.filters&quot;&gt;
          &lt;property name=&quot;language&quot; value=&quot;(language=english)&quot; /&gt;
        &lt;/property&gt;
      &lt;/mediator-instance&gt;
    &lt;/mediators&gt;

    &lt;!-- Bindings definition --&gt;
    &lt;bindings&gt;
      &lt;binding from=&quot;entryAdapter-1&quot; to=&quot;numberAddition:in1&quot; /&gt;
      &lt;binding from=&quot;entryAdapter-2&quot; to=&quot;numberAddition:in2&quot; /&gt;
      &lt;binding from=&quot;numberAddition:odd&quot; to=&quot;fr-numberConverter:in&quot; /&gt;
      &lt;binding from=&quot;numberAddition:even&quot; to=&quot;en-numberConverter:in&quot; /&gt;
      &lt;binding from=&quot;fr-numberConverter:out&quot; to=&quot;exitAdapter&quot; /&gt;
      &lt;binding from=&quot;en-numberConverter:out&quot; to=&quot;exitAdapter&quot; /&gt;
    &lt;/bindings&gt;

  &lt;/chain&gt;

&lt;/cilia&gt;
</pre> 
  </div> 
 </div> 
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->
	
	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span9 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Cilia</li>
						<li>
							<a href="index.html" title="Home">Home </a>
						</li>
						<li>
							<a href="overview.html" title="Overview">Overview </a>
						</li>
						<li>
							<a href="download.html" title="Download">Download </a>
						</li>
						<li>
							<a href="components.html" title="Available components">Available components </a>
						</li>
						<li class="nav-header">Documentation</li>
						<li class="active">
							<a href="#" title="Quick start">Quick start </a>
						</li>
						<li>
							<a href="quickstart.html#" title="DSL Reference">DSL Reference <i class="icon-chevron-down"></i></a>
							<ul class="nav nav-list">
						<li>
							<a href="dslComponent.html" title="Component Type specification">Component Type specification </a>
						</li>
						<li>
							<a href="dslCilia.html" title="Chain description">Chain description </a>
						</li>
						<li>
							<a href="cfgCilia.html" title="Chain configuration">Chain configuration </a>
						</li>
							</ul>
						</li>
						<li>
							<a href="rest-api.html" title="REST API">REST API </a>
						</li>
						<li>
							<a href="gogo-commands.html" title="Gogo commands">Gogo commands </a>
						</li>
						<li>
							<a href="apidocs/index.html" title="Javadoc">Javadoc </a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote>A service mediation framework for dynamic applications.</blockquote>
				</div>
			</div>
		</div>
	</footer>
		
	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2012-2013 <a href="http://adele.imag.fr">Adele Team | LIG</a>. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 1.7.4. </span><span class="publishDate">Last Published: 2013-12-31. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->

	<!-- Fallback jQuery loading from Google CDN:
	     http://stackoverflow.com/questions/1014203/best-way-to-use-googles-hosted-jquery-but-fall-back-to-my-hosted-library-on-go -->
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script type="text/javascript">
		if (typeof jQuery == 'undefined')
		{
			document.write(unescape("%3Cscript src='./js/jquery-1.8.3.min.js' type='text/javascript'%3E%3C/script%3E"));
		}
	</script>
	
	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.js"></script>
	<script src="./js/jquery.smooth-scroll.min.js"></script>
	<!-- back button support for smooth scroll -->
	<script src="./js/jquery.ba-bbq.min.js"></script>
	<script src="http://yandex.st/highlightjs/7.3/highlight.min.js"></script>

	<script src="./js/reflow-skin.js"></script>
	
	</body>
</html>
